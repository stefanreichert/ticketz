<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="en">
<head>
  <meta charset="ISO-8859-1"/>
  <link th:href="@{/webjars/bootstrap/5.3.3/css/bootstrap.min.css}" rel="stylesheet"/>
  <script th:src="@{/webjars/bootstrap/5.3.3/js/bootstrap.bundle.min.js}" defer></script>
</head>
<body th:fragment="header (pageheader, activeNav)">
  <div class="pt-4 mb-2">
    <span class="h3" th:text="#{header.ticketz}"></span>&nbsp;-&nbsp;<span class="text-secondary small" th:text="#{pageheader.ticketz}"></span>
  </div>
  <nav class="d-flex justify-content-between align-items-center bg-light rounded px-3 py-2 mb-4" sec:authorize="isAuthenticated()">
    <ul class="nav">
      <li class="nav-item">
        <a class="nav-link" th:classappend="${activeNav == 'tickets' ? 'text-primary fw-bold' : 'text-secondary'}" th:aria-current="${activeNav == 'tickets' ? 'page' : ''}" th:href="@{/secure/tickets}" th:text="#{button.tickets}"></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" th:classappend="${activeNav == 'projects' ? 'text-primary fw-bold' : 'text-secondary'}" th:aria-current="${activeNav == 'projects' ? 'page' : ''}" th:href="@{/secure/projects}" th:text="#{button.projects}"></a>
      </li>
      <li class="nav-item" sec:authorize="hasRole('ROLE_ADMIN')">
        <a class="nav-link" th:classappend="${activeNav == 'users' ? 'text-primary fw-bold' : 'text-secondary'}" th:aria-current="${activeNav == 'users' ? 'page' : ''}" th:href="@{/secure/users}" th:text="#{button.users}"></a>
      </li>
      <li class="nav-item" th:if="${currentUser}">
        <a class="nav-link" th:classappend="${activeNav == 'preferences' ? 'text-primary fw-bold' : 'text-secondary'}" th:aria-current="${activeNav == 'preferences' ? 'page' : ''}" th:href="@{/secure/preferences/{email}(email=${currentUser.email})}" th:text="#{button.preferences}"></a>
      </li>
    </ul>
    <div class="d-flex align-items-center">
      <span class="text-muted me-3 small" th:if="${currentUser}" th:text="${currentUser.firstname + ' ' + currentUser.lastname + ' (' + currentUser.email + ')'}"></span>
      <form th:action="@{/secure/logout}" method="post">
        <button type="submit" class="btn btn-outline-secondary btn-sm" th:text="#{button.logout}"></button>
      </form>
    </div>
  </nav>
  <div class="mb-4">
    <p class="text-muted" th:text="${pageheader}"></p>
  </div>
  <div th:if="${error}" class="mb-3">
    <span class="text-danger small strong" th:text="${error}"></span>
  </div>
  <!-- Toast container positioned at top-right -->
  <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1055;">
    <div th:if="${message}" id="messageToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="4000">
      <div class="d-flex">
        <div class="toast-body" th:text="${message}"></div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>
  <script th:if="${message}">
    document.addEventListener('DOMContentLoaded', function() {
      var toast = new bootstrap.Toast(document.getElementById('messageToast'));
      toast.show();
    });
  </script>
</body>
</html>