<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8"/>
    <link th:href="@{/webjars/bootstrap/5.3.3/css/bootstrap.min.css}" rel="stylesheet"/>
    <link th:href="@{/css/styles.css}" rel="stylesheet"/>
    <script th:src="@{/webjars/bootstrap/5.3.3/js/bootstrap.bundle.min.js}" defer></script>
    <title th:text="#{header.ticketz}"/>
</head>
<body>
<div class="container-lg">
    <div th:replace="~{/fragments/header :: header(pageheader=#{pageheader.ticket_list}, activeNav='tickets')}"></div>
    <div class="mb-3 d-flex justify-content-between align-items-center">
        <a th:href="@{/secure/tickets/new}" class="btn btn-primary" th:text="#{button.new_ticket}"></a>
        <form th:action="@{/secure/tickets}" method="get" class="d-flex gap-2">
            <input type="text" name="search" class="form-control" style="width: 250px;"
                   th:value="${search}" th:placeholder="#{label.search.placeholder}"/>
            <button type="submit" class="btn btn-outline-primary" th:text="#{button.search}"/>
            <a th:if="${search != null and !search.isEmpty()}" th:href="@{/secure/tickets}" class="btn btn-outline-secondary" th:text="#{button.clear}"/>
        </form>
    </div>
    <div class="mb-3">
        <table class="table table-striped" style="table-layout: fixed;">
            <thead>
            <tr>
                <th style="width: 12%;" th:text="#{table.header.ticket_number}"/>
                <th style="width: 10%;" th:text="#{table.header.project}"/>
                <th style="width: 28%;" th:text="#{table.header.title}"/>
                <th style="width: 14%;" th:text="#{table.header.author}"/>
                <th style="width: 14%;" th:text="#{table.header.editor}"/>
                <th style="width: 10%;" th:text="#{table.header.state}"/>
                <th style="width: 12%;"></th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="ticket : ${tickets}">
                <td th:text="${ticket.ticketNumber}"></td>
                <td>
                    <span th:text="${ticket.projectCode}"></span>
                    <span th:unless="${ticket.projectActive}" class="badge bg-secondary ms-1" th:text="#{label.project.inactive}"></span>
                </td>
                <td th:text="${ticket.title}"></td>
                <td th:text="${ticket.author.firstname + ' ' + ticket.author.lastname}"></td>
                <td th:text="${ticket.editor != null ? ticket.editor.firstname + ' ' + ticket.editor.lastname : '---'}"></td>
                <td>
                    <span th:switch="${ticket.state}">
                        <span th:case="'CREATED'" class="badge bg-info" th:text="#{CREATED}"></span>
                        <span th:case="'IN_PROGRESS'" class="badge bg-primary" th:text="#{IN_PROGRESS}"></span>
                        <span th:case="'FIXED'" class="badge bg-success" th:text="#{FIXED}"></span>
                        <span th:case="'REJECTED'" class="badge bg-warning text-dark" th:text="#{REJECTED}"></span>
                        <span th:case="'REOPENED'" class="badge bg-info" th:text="#{REOPENED}"></span>
                        <span th:case="'CLOSED'" class="badge bg-secondary" th:text="#{CLOSED}"></span>
                    </span>
                </td>
                <td class="text-end">
                    <a th:href="@{/secure/tickets/{ticketNumber}(ticketNumber=${ticket.ticketNumber})}"
                       class="btn btn-outline-primary btn-sm" th:classappend="${!ticket.projectActive ? 'disabled' : ''}" th:text="#{button.edit}">
                    </a>
                    <button class="btn btn-outline-danger btn-sm" th:text="#{button.delete}"
                       th:disabled="${!ticket.projectActive}"
                       data-bs-toggle="modal" th:attr="data-bs-target=${'#confirm_' + ticket.ticketNumber}">
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
        <div th:if="${tickets.isEmpty()}" class="text-center text-muted py-4">
            <span th:if="${search != null and !search.isEmpty()}" th:text="#{label.ticket.no_search_results}"></span>
            <span th:unless="${search != null and !search.isEmpty()}" th:text="#{label.ticket.no_tickets}"></span>
        </div>
    </div>
    <div th:each="ticket : ${tickets}">
        <div th:replace="~{/fragments/confirm_dialog :: confirm(id=${'confirm_' + ticket.ticketNumber}, title=#{dialog.delete_ticket.title}, message=#{dialog.delete_ticket.message(${ticket.ticketNumber})}, confirm_url=@{/secure/tickets/{ticketNumber}:delete(ticketNumber=${ticket.ticketNumber})}, confirm_label=#{button.delete})}"></div>
    </div>
    <div th:replace="~{/fragments/footer :: footer}"></div>
</div>
</body>
</html>